<div class="ui container">
  <ng-container *ngIf="book$ | async; else loading">
    <form class="ui form" [formGroup]="editForm" (ngSubmit)="submitForm()">
      <div class="field">
        <label for="title">Title: </label>
        <input id="title" type="text" formControlName="title" />
      </div>
      <div class="field">
        <label for="subtitle">Subtitle: </label>
        <input id="subtitle" type="text" formControlName="subtitle" />
      </div>

      <div class="field">
        <label for="isbn">ISBN: </label>
        <input id="isbn" type="text" formControlName="isbn" required />

        <div *ngIf="isbn?.invalid && (isbn?.dirty || isbn?.touched)">
          <div *ngIf="isbn?.errors?.['minlength']" class="ui red message">
            Name must be at least 11 characters long.
          </div>
          <div *ngIf="isbn?.errors?.['maxlength']" class="ui red message">
            Name must be max 13 characters long.
          </div>
        </div>
      </div>
      <div class="field">
        <label for="published">Published: </label>
        <input id="published" type="text" formControlName="published" />
      </div>
      <div class="field">
        <label for="description">Description: </label>
        <input id="description" type="text" formControlName="description" />
      </div>

      <h4 class="ui dividing header">Authors:</h4>
      <ng-container *ngIf="authors?.controls">
        <div
          formArrayName="authors"
          class="inline fields"
          *ngFor="let auth of authors.controls; index as i"
        >
          <div class="field">
            <input type="text" [formControlName]="i" />
          </div>
        </div>
      </ng-container>
      <h4 class="ui dividing header">Thumbs:</h4>
      <div class="inline fields">
        <ng-container *ngIf="thumbnails?.controls">
          <div
            class="inline fields"
            formArrayName="thumbnails"
            *ngFor="let thumb of thumbnails?.controls; index as j"
          >
            <div class="inline fields" [formGroupName]="j">
              <div class="field">
                <input id="url" type="text" formControlName="url" />
              </div>
              <div class="field">
                <input type="text" formControlName="description" />
              </div>
            </div>
          </div>
        </ng-container>
      </div>
      <button
        type="submit"
        class="ui disabled button"
        [class.disabled]="editForm.invalid"
        [class.primary]="!editForm.invalid"
      >
        Save
      </button>
    </form>
  </ng-container>
  <ng-template #loading>
    <p>Waiting ...</p>
  </ng-template>
</div>
